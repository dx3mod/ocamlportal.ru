---
outline: deep
---

# Пакетный менеджер OPAM

[OCaml Package Manager](https://opam.ocaml.org/) (или просто OPAM) &mdash; пакетный менеджер для OCaml,
управляющий пакетами в их исходном виде (в виде исходников), является частью [OCaml Platform](https://ocaml.org/platform),
как и [Dune](./dune.md).

Через него можно поставить компилятор и всё остальное.

::: details Опыт использования OPAM
![](https://i.ibb.co/Q6YSgG3/photo-2024-07-05-23-01-27.jpg)
:::

> [!NOTE] Документация
> 
> - [Управление зависимостями](https://ocaml.org/docs/managing-dependencies)
> - [Using opam](https://opam.ocaml.org/doc/Usage.html) &mdash; всё что нужно знать, чтобы использовать
> - Полный [мануал](https://opam.ocaml.org/doc/Manual.html) с описанием всех возможностей

> [!INFO] Смотрите также 
> - Система сборки [Dune](./dune.md) &mdash; умеет генерировать OPAM-манифест 
>  и много что ещё 

## Обновление пакетов

```sh
$ opam update
$ opam upgrade
```

Могут возникать ошибки, из-за конфликта версий, но тут остается страдать.

## Установка зависимостей проекта

Если проект имеет OPAM-манифест, то вы можете установить зависимости прописанные в нём, 
используя следующую команду:

```sh
$ opam install . --deps-only
```

## Окружения (они же switches)

OPAM хранит компилятор и пакеты в окружениях, называемые `switch`. При стандартной установки у вас должно появиться глобальное `default` окружение.

> [!NOTE] Работа с окружениями
> Для работы с окружениями используйте команды из подгруппы `opam switch`.

### Локального окружения для проекта

Распространенная задача, если у нас некий проект и мы хотим иметь специфичный набор пакетов, определённый компилятор и т.д.
В случае если у нас есть OPAM-манифест, мы можем создать локальное окружение следующей командой:

```sh
$ opam switch create . --deps-only
```

> [!IMPORTANT] Будьте внимательны
> Данная команда создаст *локальное* окружение, что будет актируется по пути, в котором была выполнена команда.
> Создание локального окружение сопровождается инициализацией всего тулчейна и набора библиотек &mdash; это потребует
> время, а также вычислительные возможности. 

## Публикация пакета

Смотрите [тут](../recipes/publish-package.md).

## Pin

Команда `opam pin` позволяет более гибко работать с версиями пакетов: фиксировать конкретные версии, 
ставить локальные пакеты или upstream версии удалённых и т.д..

> [!NOTE] Пример установки upstream версии пакета с Git-репозитория
> ```sh
> $ opam pin nats-client-lwt.dev https://github.com/romanchechyotkin/nats.ocaml.git
> ```
> - `dev` &mdash; означает самый последний коммит

> [!NOTE] Пример установки локального проекта
> ```sh
> $ opam pin ~/projects/my-logger
> ```

## Зависимости

### pin-depends

Если вы хотите [_запинить_](#pin) зависимость в вашем пакете, то вы должно прописать поле `pin-depends` в ваш `.opam` манифест (для [Dune](./dune.md#opam-template) смотрите `.opam.template`).

Пример добавления библиотеки [vkashka](../libraries/web/vkashka.md) с Git репозитория:

```opam
pin-depends: [
  [ "vkashka.dev" "git+https://github.com/dx3mod/vkashka.git" ]
]
```

Оф. документация: <https://opam.ocaml.org/doc/Manual.html#opamfield-pin-depends>.
