# ÐžÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²

ÐžÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ (Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ) Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð² â€” ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° Ð² Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ð½Ð¾Ð¼ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸, 
Ð¿Ð¾ÑÐºÐ¾Ð»ÑŒÐºÑƒ Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð»ÑŽÐ±Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ñ€ÐµÑÑƒÑ€ÑÐ°Ð¼Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
Ð¸Ð»Ð¸ Ð¸Ð½Ñ‹Ð¼Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ð¼Ð¸.

> [!TIP] Ð ÐµÑÑƒÑ€Ñ
> Ð­Ñ‚Ð¾ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð² Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ðµ, Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÑŽÑ‰Ð¸Ð¹ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ€ÐµÑÑƒÑ€Ñ, Ð±ÑƒÐ´ÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¸Ð»Ð¸
> Ð²Ñ‹Ñ‡Ð¸ÑÐ»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹. Ð¢Ð°ÐºÐ¾Ð¹ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð¸Ð¼ÐµÐµÑ‚ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» Ð¶Ð¸Ð·Ð½Ð¸: Ð¾Ð½ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ, ÐµÐ³Ð¾
> Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚, Ð° Ð¿Ð¾ÑÐ»Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´Ð°ÑŽÑ‚.
>
> ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð² ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ð¹ Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€, ÑÐµÑ‚ÐµÐ²Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ, 
> Ð¿Ð¾Ñ‚Ð¾Ðº Ð¸Ð»Ð¸ Ð´Ð°Ð¶Ðµ Ð±ÑƒÑ„ÐµÑ€ Ð¿Ð°Ð¼ÑÑ‚Ð¸, Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ð¹ Ð² ÑÑ‚Ñ€Ð¾Ð³Ð¾Ð¼ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ðµ.
> 
> ÐÐµÐ¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð½Ñ‹Ð¹ Ñ€ÐµÑÑƒÑ€Ñ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ðº Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸ÑÐ¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹, Ñ‚Ð°Ðº ÐºÐ°Ðº Ñ€ÐµÑÑƒÑ€ÑÑ‹ 
> Ð¿Ð¾Ð´Ñ€Ð°Ð·ÑƒÐ¼ÐµÐ²Ð°ÑŽÑ‚ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð¸Ñ… Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ, Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ñ… 
> Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€Ð¾Ð² Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ðº Ñ‚Ð¾Ð¼Ñƒ, Ñ‡Ñ‚Ð¾ Ñƒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ñ‚ÑÑ Ð¸Ñ… ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ°,
> Ð¿Ð¾ÑÐ»Ðµ Ñ‡ÐµÐ³Ð¾ Ð±ÐµÐ· Ð´Ð¾Ð»Ð¶Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑÑ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ðº Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸ÑŽ, Ð»Ð¸Ð±Ð¾ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹. 

> [!INFO] ÐšÐ°Ðº ÑÑ‚Ð¾ Ð² Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÑÐ·Ñ‹ÐºÐ°Ñ…?
> 
> Ð’ ÑÐ·Ñ‹ÐºÐµ Ð²Ñ€Ð¾Ð´Ðµ C++ Ð¸Ð»Ð¸ Rust Ð´Ð»Ñ ÑÑ‚Ð¾ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð½Ð°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ð° [RAII],
> Ð½Ð¾ Ð¾Ð½ Ð½Ðµ ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ ÑÑ€ÐµÐ´Ð°Ð¼ Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼ Ð¿Ð°Ð¼ÑÑ‚ÑŒÑŽ (Ñ‚.Ðµ [GC]).

Ð”Ð°Ð»ÐµÐµ Ð¿Ñ€Ð¸Ð²ÐµÐ´ÐµÐ½Ñ‹ Ð¸Ð´Ð¸Ð¾Ð¼Ñ‹ Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ ÐºÐ°Ðº ÑÑ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° OCaml.

## Ð ÑƒÑ‡Ð½Ð¾Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ

> [!CAUTION] ðŸ‘‚ ÐÐµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼ Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ, ÐºÐ¾Ð³Ð´Ð° Ñ‚Ð¾Ð³Ð¾ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð½Ð¸Ð·ÐºÐ¾ÑƒÑ€Ð¾Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ÑÑ‚Ð¸! 

ÐŸÑ€Ð¸ Ñ‚Ñ€Ð°Ð´Ð¸Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¼ (Ñ€ÑƒÑ‡Ð½Ð¾Ð¼) Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ð¸ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð² (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ `close`) Ð¼Ð¾Ð³ÑƒÑ‚ 
Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½ÑƒÑ‚ÑŒ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ &mdash; ÑÑ‚Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð±Ñ‹Ñ‚ÑŒ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¸Ð»Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ñ€Ð°Ð½Ð¾, Ð»Ð¸Ð±Ð¾
Ð²Ð¾Ð²ÑÐµ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾

> [!NOTE] ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð°
>
> ```ocaml
> let read_first_line_from_file filename = 
>   let file = open_in filename in 
>   let line = input_line file in 
>   close_in file;
>   line
> ```

:::details ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸ {open}
- :triangular_flag_on_post: Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ: Ð»ÐµÐ³ÐºÐ¾ Ð·Ð°Ð±Ñ‹Ñ‚ÑŒ, Ð¼Ð½Ð¾Ð³Ð¾ÑÐ»Ð¾Ð²Ð½Ð¾;
- :triangular_flag_on_post: Ð¯Ð²Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð³Ð¾ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ñ€ÐµÑÑƒÑ€ÑÐ°;
- :triangular_flag_on_post: Ð“Ñ€Ð¾Ð¼Ð¾Ð·Ð´ÐºÐ¾ Ð¿Ñ€Ð¸ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²;
:::

## Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ñ &mdash; Ñ‚Ð°ÐºÐ¶Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ 

Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ñ &mdash; Ñ‚Ð°ÐºÐ¶Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ, Ð¸Ð»Ð¸ Ð¶Ðµ `with_` Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ, 
Ñ€Ð°ÑÐ¿ÐµÑÑ‚Ñ€ÐµÐ½Ð½Ñ‹Ð¹ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ ÐºÐ°Ðº Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð¹ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐµ, Ñ‚Ð°Ðº Ð¸ Ð² ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½Ð¸Ñ….  

```ocaml
let _ = 
  File.with_open filename @@ fun resource ->
    (* processing *)
  (* auto close file *)
```

Ð¡ÑƒÑ‚ÑŒ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð° Ð·Ð°ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð² Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‰ÑƒÑŽ Ñ€ÐµÑÑƒÑ€Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ñ‚ÑŒ 
ÑÑ€Ð°Ð·Ñƒ callback, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÐºÐ°Ðº-Ð±Ñ‹ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÑ‚ÑŒÑÑ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°. 
ÐŸÑ€Ð¸ ÑÑ‚Ð¾Ð¼ Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ, Ñ€ÐµÑÑƒÑ€Ñ Ð±ÑƒÐ´ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð·Ð°ÐºÑ€Ñ‹Ñ‚.

> [!NOTE] Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ñ‚Ð°ÐºÐ¶Ðµ 
> - [Channels: Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°](./channels.md#Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ-Ñ€Ð°Ð±Ð¾Ñ‚Ð°)

> [!NOTE] ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ with_ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ 
>
> Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ `Fun.protect`, Ð²Ð°Ð¼ Ð½Ðµ ÑÐ»ÐµÐ´ÑƒÐµÑ‚ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ 
> Ð²Ð¾Ð·Ð½Ð¸ÐºÐ°ÑŽÑ‰Ð¸Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ! Ð¢Ð°Ðº ÐºÐ°Ðº Ð² Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÑ‡Ð½Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ ÑƒÐ¶Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾
> Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð° stack trace'Ð° Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ.
> 
> ```ocaml
> let initialize _ = (* ... *)
> let dispose _ = (* ... *)
> 
> let with_initialize _ f = 
>   let resource = initialize _ in 
>   Fun.protect 
>     (fun () -> f resource)
>     ~finally:(fun () -> dispose resource) 
> ```

:::details ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸ {open}
- :triangular_flag_on_post: ÐžÐ±Ñ€Ð°Ð·ÑƒÐµÑ‚ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð² Ð² Ð¾Ð´Ð½Ð¾Ð¹ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸ Ð²Ð¸Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸;
- :triangular_flag_on_post: ÐÐµ Ð¿Ð¾Ð´Ð´Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽ, ÐºÐ¾Ð³Ð´Ð° Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÑÑƒÑ€Ñ;
:::

## Switches 

> [!NOTE] Ð’ Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÑÐ·Ñ‹ÐºÐ°Ñ…
>
> Ð¡Ñ…Ð¾Ð¶ÑƒÑŽ ÐºÐ¾Ð½Ñ†ÐµÐ²ÑƒÑŽ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ ÑÐ·Ñ‹ÐºÐ° Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð² Python Ð¸ C#.
> Ð’ Ð¿ÐµÑ€Ð²Ð¾Ð¼ ÑÑ‚Ð¾ Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ [context manager](https://habr.com/ru/companies/auriga/articles/724030/).
> Ð’ C# Ð¶Ðµ Ð¾Ð½Ð° Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ [try-with-resources](https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/statements/using).
> 
> Ð’ Ð¾Ð±Ð¾Ð¸Ñ… ÑÐ»ÑƒÑ‡Ð°ÑÑ… Ð¾Ð½Ð¸ Ð¾Ð¿Ð¸Ñ€Ð°ÑŽÑ‚ÑÑ Ð½Ð° ÑÐ²Ð¾ÑŽ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½ÑƒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð¸ Ð½Ð° Ñ‚Ðµ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð°, Ñ‡Ñ‚Ð¾ Ð¸Ñ… 
> Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹-Ñ€ÐµÑÑƒÑ€ÑÑ‹ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÑŽÑ‚ disposable Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ. 
 
**Switch** (Ð¾Ð½ Ð¶Ðµ *ÑÐ²Ð¸Ñ‚Ñ‡*) &mdash; Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ Ð²Ð¸Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸, Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‰Ð°Ñ Ð¿Ð¾ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñƒ 
Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ hooks (aka callbacks), Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ñ… Ðº Ð½ÐµÐ¹, Ð¸ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¿Ð¾ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸ÑŽ ÑÑ‚Ð¾Ð¹ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸.

Ð¢Ð°ÐºÐ¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¼Ñ‹ ÐºÐ°Ðº-Ð±Ñ‹ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ Ñ€ÐµÑÑƒÑ€Ñ Ðº ÑÐ²Ð¸Ñ‚Ñ‡Ñƒ, Ð½Ð¾ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ 
hook Ð¿Ð¾ ÐµÐ³Ð¾ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸ÑŽ, Ñ‡Ñ‚Ð¾ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾ Ð³Ð¸Ð±Ñ‡Ðµ, Ñ‡ÐµÐ¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ñ‹.

> [!NOTE] ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Eio.Switch
> Ð­Ñ‚Ð¾Ñ‚ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ ÑÑ€ÐºÐ¾ Ð²ÑÑ‚Ñ€ÐµÑ‚Ð¸Ñ‚ÑŒ Ð² Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐµ [Eio](../libraries/concurrency/eio.md).
> ÐžÐ½ Ñ‚Ð°Ð¼ Ð¿Ð¾Ð²ÑÐµÐ¼ÐµÑÑ‚ÐµÐ½ Ð¸ Ð±ÐµÐ· Ð½ÐµÐ³Ð¾ Ð½ÐµÐ»ÑŒÐ·Ñ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ, Ñ‚Ð°Ðº ÐºÐ°Ðº Ñ€ÐµÑÑƒÑ€Ñ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ðº Ñ‡ÐµÐ¼Ñƒ-Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½.
> ```ocaml
> let run_client ~net ~addr =
>   Switch.run ~name:"client" @@ fun sw ->
>   traceln "Client: connecting to server";
>   let flow = Eio.Net.connect ~sw net addr in
>   (* Read all data until end-of-stream (shutdown): *)
>   traceln "Client: received %S" (Eio.Flow.read_all flow)
> ```

> [!NOTE] ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Lwt_switch
> Ð’ [Lwt] Ñ‚Ð¾Ð¶Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸ ÑÐ²Ð¸Ñ‚Ñ‡Ð¸ ÐºÐ°Ðº Ð´Ð¾Ð¿. Ð°Ð±ÑÑ‚Ñ€Ð°ÐºÑ†Ð¸Ð¸ &mdash; Ð¼Ð¾Ð´ÑƒÐ»ÑŒ [Lwt_switch].
> ```ocaml
> let main = 
>   Lwt_switch.with_switch @@ fun sw ->
>   let* file = Lwt_io.open_file "some-file" ~mode:Output in
>   Lwt_switch.add_hook (Some sw) (fun () -> Lwt_io.close file);
>   Lwt.return_unit
> ```
> Ð§Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ Ð½Ð° [Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ](../libraries/concurrency/lwt.md#switches). 

:::details ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸ {open}
- :triangular_flag_on_post: Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Switch'Ð° Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹;
:::

## ÐžÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ ÑƒÐ½Ð¸Ñ‡Ñ‚Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°

> [!CAUTION] ðŸ‘‚ ÐÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÑ‚Ð¾! 
> ÐÐµ Ð¿Ð¾Ð´Ð´Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽ Ð¸ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÑ‚ÑÑ Ð½Ð° Ð´ÐµÑ‚Ð°Ð»Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸.
> Ð­Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½Ðµ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ. Ð­Ñ‚Ð° ÑÐµÐºÑ†Ð¸Ñ Ð¿Ñ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð° Ð¸ÑÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾
> Ð² Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ†ÐµÐ»ÑÑ…. 

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ ÑÐ±Ð¾Ñ€Ñ‰Ð¸ÐºÐ° Ð¼ÑƒÑÐ¾Ñ€Ð° (Ð¼Ð¾Ð´ÑƒÐ»ÑŒ [Gc](https://ocaml.org/manual/api/Gc.html)) Ð¼Ñ‹ Ð¼Ð¾Ð¶ÐµÐ¼ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, 
Ñ‡Ñ‚Ð¾ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð° Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° ÑÐ±Ð¾Ñ€Ñ‰Ð¸ÐºÐ° Ð¼ÑƒÑÐ¾Ñ€Ð°.

Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½Ð° heap-allocated Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ñ…! 

> [!NOTE] ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹
> Ð”Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ [`finalise`](https://ocaml.org/manual/5.2/api/Gc.html#VALfinalise) Ð¸ 
> [`alarm`](https://ocaml.org/manual/5.2/api/Gc.html#TYPEalarm).

> [!IMPORTANT] Ð¡Ñ‚Ð¾Ð¸Ñ‚ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ
> ÐžÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ Ñ€ÐµÑÑƒÑ€ÑÐ° Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´Ñ‘Ñ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚Ð¾Ð³Ð´Ð°, ÐºÐ¾Ð³Ð´Ð° OCaml Ñ€ÐµÑˆÐ¸Ñ‚ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚, 
> Ð° ÑÑ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ñ‚Ð¸ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ. Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ [Memory management](./performance.md#memory-management).

> [!NOTE] Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° Lwt
> Ð’ Ð¿Ð°ÐºÐµÑ‚Ðµ `lwt.unix` (Ñ‡Ð°ÑÑ‚ÑŒ [Lwt](../libraries/concurrency/lwt.md)) ÐµÑÑ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ `Lwt_gc` Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ `finalise_or_exit`, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾
> Ð¿Ñ€Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ñ€ÐµÑÑƒÑ€Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´Ñ‘Ð½ (Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ð½Ð° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´Ñ‘Ñ‚ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ).
> 
> :::details ÐŸÑ€Ð¸Ð¼ÐµÑ€
> ```ocaml
> let main = 
>   let res = String.make 10 'x' in
>   Lwt_gc.finalise_or_exit (Lwt_io.printlf "free '%s'") res;
>   Lwt.return_unit
> ```
> :::

[RAII]: https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B0_%D0%B5%D1%81%D1%82%D1%8C_%D0%B8%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F
[GC]: https://ru.wikipedia.org/wiki/%D0%A1%D0%B1%D0%BE%D1%80%D0%BA%D0%B0_%D0%BC%D1%83%D1%81%D0%BE%D1%80%D0%B0

[Lwt]: ../libraries/concurrency/lwt.md
[Lwt_switch]: https://ocsigen.org/lwt/latest/api/Lwt_switch